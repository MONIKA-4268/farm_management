<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FarmPortal - Log Entry & Search</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(135deg, #e6ffe6 0%, #b7e4c7 45%, #229954 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #222;
    }
    .navbar { background: #229954 !important; }
    .navbar-brand { color: #145a32 !important; font-weight: bold; font-size: 2rem; letter-spacing: 2px; }
    .nav-link { color: #f7fafc !important; font-weight: 500; }
    .nav-link.active, .nav-link:hover { color: #229954 !important; background: #d6f5d6; border-radius: 6px; }
    .tab-section { display: none; background: #fff; border-radius: 14px; box-shadow: 0 2px 16px #22995433; padding: 2rem 2.5rem; margin-top: 2.5rem; animation: fadeInDown 0.4s; color: #145a32; min-height: 70vh; overflow-y: auto;}
    .active-section { display: block !important; }
    @keyframes fadeInDown { from {opacity: 0;transform: translateY(-20px);} to {opacity: 1;transform: translateY(0);} }
    table { width: 100%; border-collapse: collapse; color: #145a32; }
    thead { background: #d6f5d6; color: #229954; font-weight: bold; }
    tbody tr:nth-child(odd) { background: #f5fbff; }
    tbody tr:hover { background: #e6ffe6; }
    th, td { padding: 12px 8px; border: 1px solid #c6efce; text-align: center; }
    .form-inline, .form-group, .form-control { background: #fff !important; color: #145a32 !important; }
    .form-control::placeholder { color: #229954; font-style: italic; font-size: 1em; }
    .btn-success, .btn-warning, .btn-danger, .btn-outline-danger { font-weight: 600; border-radius: 5px; }
    .btn-success { background: #229954; border: none; color: white; }
    .btn-success:hover { background: #145a32; }
    .btn-warning { background: #ffe066; border: none; color: #145a32; }
    .btn-warning:hover { background: #ffd633; }
    .btn-danger { background: #d35400; border: none; color: white; }
    .btn-danger:hover { background: #ba4a00; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light shadow-sm">
    <a class="navbar-brand" href="#">
      <img src="farm.jpg" alt="Farm Logo" style="height:48px;vertical-align:middle;margin-right:10px;" />
      FarmPortal
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navMenu" aria-controls="navMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item"><a class="nav-link" href="#" id="navDashboard"></a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="navCow"></a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="navMedRec"></a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="navMRL"></a></li>
        <li class="nav-item"><a class="nav-link" href="#" id="navAMU"></a></li>
      </ul>
      <button id="logout-btn" class="btn btn-outline-danger my-2 my-sm-0"><i class="fa fa-sign-out-alt"></i> <span id="logoutText"></span></button>
    </div>
  </nav>

  <div class="container tab-section active-section" id="dashboard">
    <h2 id="dashboardTitle">Dashboard</h2>
    <p id="dashboardDesc">Welcome to FarmPortal Dashboard.</p>
  </div>
  <div class="container tab-section" id="cow-section">
    <h3 class="mt-3"><i class="fas fa-hippo"></i> <span id="cowTitle"></span></h3>
    <div class="bg-white p-3 rounded shadow-sm mb-4">
      <h4 id="cowPrompt"></h4>
      <label for="cowId" id="cowIdLabel"></label>
      <input type="text" id="cowId" placeholder="e.g., C001" />
      <button type="button" onclick="showCowData()" id="cowShowBtn"></button>
      <div id="result"></div>
    </div>
  </div>
  <div class="container tab-section" id="medrec-section">
    <h3 class="mt-3"><i class="fas fa-capsules"></i> <span id="medRecTitle"></span></h3>
    <form id="recommend-form" class="mb-3">
      <div class="row">
        <div class="col">
          <input class="form-control mb-2" id="recBreed" placeholder="" required>
        </div>
        <div class="col">
          <input class="form-control mb-2" id="recAge" type="number" placeholder="" required>
        </div>
        <div class="col">
          <input class="form-control mb-2" id="recDisease" placeholder="" required>
        </div>
        <div class="col">
          <button type="button" class="btn btn-info" id="recommendBtn"></button>
        </div>
      </div>
    </form>
    <div id="recommendResult" class="mb-3"></div>
  </div>
  <div class="container tab-section" id="mrl-section" style="background: #f8fff5;">
    <h3 class="mt-3" style="color:#229954;"><i class="fas fa-vial"></i> <span id="manageMRL"></span></h3>
    <!-- MRL Form Starts Here -->
    <form id="mrl-form" class="form-inline mb-3 bg-white p-3 rounded shadow-sm">
      <input type="text" class="form-control mr-2 mb-2" name="chemical" placeholder="Chemical (e.g. Amoxicillin)" required />
      <input type="text" class="form-control mr-2 mb-2" name="species" placeholder="Species (e.g. Cow)" />
      <input type="number" class="form-control mr-2 mb-2" name="maxResidue" step="0.01" placeholder="Max Residue (mg/kg)" />
      <input type="text" class="form-control mr-2 mb-2" name="cowId" placeholder="Cow ID (e.g. C001)" required />
      <input type="number" class="form-control mr-2 mb-2" name="dosageInput" placeholder="Dosage (mg)" required />
      <button type="submit" class="btn btn-warning text-white mb-2" id="addMRLBtn"><i class="fas fa-plus"></i></button>
    </form>
    <input type="text" id="mrl-search" class="form-control mb-3" placeholder="" style="border:1px solid #8fd19e;" />
    <div class="table-responsive bg-white p-2 rounded shadow-sm" style="border:2px solid #8fd19e;">
      <table id="mrl-table">
        <thead>
          <tr>
            <th id="chemTh"></th>
            <th id="speciesTh"></th>
            <th id="maxResTh"></th>
            <th>Milk Yield</th>
            <th>Warning</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  <div class="container tab-section" id="amu-section" style="background:#f8fff5;">
    <h3 class="mt-3" style="color:#38761d;"><i class="fas fa-syringe"></i> <span id="logAMU"></span></h3>
    <form id="amu-form" class="form-inline mb-3 bg-white p-3 rounded shadow-sm" style="border:2px solid #8fd19e;">
      <input type="text" class="form-control mr-2 mb-2" name="tagNo" placeholder="Tag No. (Ear Tag/ID)" required />
      <input type="text" class="form-control mr-2 mb-2" name="chemical" placeholder="Drug Used" required />
      <input type="date" class="form-control mr-2 mb-2" name="date" required />
      <input type="text" class="form-control mr-2 mb-2" name="dosage" placeholder="Dosage Amount" required />
      <button type="submit" class="btn btn-danger mb-2" id="logAMUBtn"><i class="fas fa-plus"></i></button>
    </form>
    <input type="text" id="amu-search" class="form-control mb-3" placeholder="" style="border:1px solid #8fd19e;" />
    <div class="table-responsive bg-white p-2 rounded shadow-sm" style="border:2px solid #8fd19e;">
      <table class="table table-bordered text-center" id="amu-table" style="color:#38761d;">
        <thead style="background:#d6f5d6;">
          <tr><th id="tagTh"></th><th id="chemAMUTh"></th><th id="dateTh"></th><th id="dosageTh"></th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Place ALL scripts at the end, just before </body> -->
  <script>
  // ... your dict, cows, medicineRecommendations, setUIText, tab logic, cow display, med rec, MRL logic stay the same ...

  // Fix: REMOVE/REPLACE this AMU FORM HANDLER so you post to BACKEND
  document.getElementById('amu-form').onsubmit = async function(e) {
    e.preventDefault();
    const { tagNo, chemical, date, dosage } = e.target.elements;

    // Prepare data for backend
    const amuLog = {
      tagNo: tagNo.value,
      chemical: chemical.value,
      date: date.value,
      dosage: dosage.value
    };

    // Send to backend (change URL if needed)
    let response;
    try {
      response = await fetch('/api/amus', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(amuLog)
      });
    } catch (err) {
      alert('Failed to connect to backend!');
      return;
    }

    if (response.ok) {
      alert('AMU Log saved successfully!');
      // Optionally: fetch logs from backend and call renderAMU(logs)
    } else {
      alert('Failed to save AMU log!');
    }

    e.target.reset();
  };

  // Optionally: add code to fetch AMU logs from backend and render table on load
  // Example:
  async function fetchAndRenderAMULogs() {
    try {
      const res = await fetch('/api/amus');
      if (!res.ok) return;
      const logs = await res.json();
      renderAMU(logs);
    } catch (err) {
      // backend not reachable
    }
  }
  // Uncomment if you want to load logs from backend:
  // fetchAndRenderAMULogs();

  // If you want search to work with backend data, update search logic to use the fetched logs not amuData array

  // All other code remains unchanged

  
const dict = {
  en: {
    dashboard: 'Dashboard',
    dashboardWelcome: 'Welcome to FarmPortal Dashboard',
    dashboardDesc: 'Use navigation above to manage Cows, Medicine Recommendations, MRL, and AMU logs.',
    cow: 'Cow',
    cowPrompt: 'Enter Cow ID to Get Details',
    cowIdLabel: 'Cow ID:',
    cowShowBtn: 'Show Details',
    medRec: 'Medicine Recommendation',
    medRecBreed: 'Breed',
    medRecAge: 'Age (Months)',
    medRecDisease: 'Health Issue',
    medRecBtn: 'Recommend Medicine',
    mrl: 'MRL',
    manageMRL: 'Manage Maximum Residue Limits (MRL)',
    chemicalPlaceholder: 'Chemical (e.g. Natural/Organic/Drug)',
    speciesPlaceholder: 'Livestock Species (e.g. Cow, Goat)',
    maxResiduePlaceholder: 'Max Residue (mg/kg)',
    addMRLBtn: 'Add MRL',
    searchMRLPlaceholder: 'Search MRL...',
    chemTh: 'Chemical',
    speciesTh: 'Species',
    maxResTh: 'Max Residue',
    amuLogs: 'AMU Logs',
    logAMU: 'Log Antimicrobial Usage (AMU)',
    amuTagNoPlaceholder: 'Tag No. (Ear Tag/ID)',
    amuChemicalPlaceholder: 'Drug Used',
    amuDatePlaceholder: 'Date of Usage',
    amuDosagePlaceholder: 'Dosage Amount',
    logAMUBtn: 'Log AMU',
    searchAMUPlaceholder: 'Search AMU Logs...',
    tagTh: 'Tag No.',
    chemAMUTh: 'Chemical',
    dateTh: 'Date',
    dosageTh: 'Dosage',
    logout: 'Logout'
  },
  ta: {
    dashboard: 'டாஷ்போர்டு',
    dashboardWelcome: 'FarmPortal தளத்திற்கு வரவேற்கின்றோம்',
    dashboardDesc: 'மேலே உள்ள வழிசெலுத்தலைப் பயன்படுத்தி காளைகள், மருந்து பரிந்துரை, MRL மற்றும் AMU பதிவுகளை நிர்வகிக்கவும்.',
    cow: 'காள்',
    cowPrompt: 'காள் ஐடி உள்ளிடவும்',
    cowIdLabel: 'காள் ஐடி:',
    cowShowBtn: 'விவரங்கள்',
    medRec: 'மருந்து பரிந்துரை',
    medRecBreed: 'இனம்',
    medRecAge: 'வயது (மாதங்கள்)',
    medRecDisease: 'நோய்/பிரச்சனை',
    medRecBtn: 'மருந்தை பரிந்துரைக்கவும்',
    mrl: 'MRL',
    manageMRL: 'அதிகபட்ச இருப்பு அளவு (MRL) நிர்வகி',
    chemicalPlaceholder: 'ரசாயனம்/இயற்கை/மருந்து',
    speciesPlaceholder: 'விலங்கு வகை (காள், ஆடு)',
    maxResiduePlaceholder: 'அதிகபட்ச இருப்பு (மி.கி/கி)',
    addMRLBtn: 'MRL சேர்க்க',
    searchMRLPlaceholder: 'MRL தேடு...',
    chemTh: 'ரசாயனம்',
    speciesTh: 'வகை',
    maxResTh: 'அதிகபட்ச இருப்பு',
    amuLogs: 'AMU பதிவுகள்',
    logAMU: 'மருந்து பயன்பாடு பதிவு',
    amuTagNoPlaceholder: 'Tag No. (காது டேக்/ஐடி)',
    amuChemicalPlaceholder: 'பயன்படுத்தப்பட்ட மருந்து',
    amuDatePlaceholder: 'பயன்படுத்திய தேதி',
    amuDosagePlaceholder: 'அளவு',
    logAMUBtn: 'AMU பதிவு செய்',
    searchAMUPlaceholder: 'AMU பதிவுகளைத் தேடு...',
    tagTh: 'Tag No.',
    chemAMUTh: 'ரசாயனம்',
    dateTh: 'தேதி',
    dosageTh: 'அளவு',
    logout: 'வெளியேறு'
  }
};

const cows_en = {
  "C001": { "Breed": "Holstein-Friesian", "Age": 4.4, "Sex": "F", "Weight": 680, "Vaccination": "Up-to-date", "MilkYield": 31 },
  "C002": { "Breed": "Holstein-Friesian", "Age": 5.0, "Sex": "F", "Weight": 710, "Vaccination": "FMD (2025-03-10)", "MilkYield": 29 },
  "C003": { "Breed": "Jersey", "Age": 2.6, "Sex": "F", "Weight": 440, "Vaccination": "Up-to-date", "MilkYield": 21 },
  "C004": { "Breed": "Angus", "Age": 2.8, "Sex": "M", "Weight": 850, "Vaccination": "Up-to-date", "MilkYield": 0 },
  "C005": { "Breed": "Jersey", "Age": 6.1, "Sex": "F", "Weight": 465, "Vaccination": "BQ Vaccine (2025-05-01)", "MilkYield": 0 },
  "C006": { "Breed": "Hereford", "Age": 1.5, "Sex": "F", "Weight": 520, "Vaccination": "Up-to-date", "MilkYield": 0 },
  "C007": { "Breed": "Gir", "Age": 4.0, "Sex": "F", "Weight": 490, "Vaccination": "Anthrax (2025-04-15)", "MilkYield": 13 },
  "C008": { "Breed": "Angus", "Age": 3.3, "Sex": "M", "Weight": 910, "Vaccination": "Up-to-date", "MilkYield": 0 },
  "C009": { "Breed": "Holstein-Friesian", "Age": 2.2, "Sex": "F", "Weight": 590, "Vaccination": "Up-to-date", "MilkYield": 25 },
  "C010": { "Breed": "Jersey", "Age": 5.6, "Sex": "F", "Weight": 455, "Vaccination": "FMD Booster (2025-03-12)", "MilkYield": 20 },
  "C011": { "Breed": "Holstein", "Age": 4.5, "Sex": "F", "Weight": 460, "Vaccination": "FMD Booster (2025-03-15)", "MilkYield": 28 },
  "C012": { "Breed": "Jersey", "Age": 5.1, "Sex": "F", "Weight": 405, "Vaccination": "Up-to-date", "MilkYield": 20 },
  "C013": { "Breed": "Sahiwal", "Age": 6.0, "Sex": "F", "Weight": 510, "Vaccination": "Up-to-date", "MilkYield": 14 },
  "C014": { "Breed": "Gir", "Age": 4.8, "Sex": "F", "Weight": 475, "Vaccination": "Anthrax (2025-04-02)", "MilkYield": 12 },
  "C015": { "Breed": "Holstein", "Age": 3.9, "Sex": "F", "Weight": 490, "Vaccination": "Up-to-date", "MilkYield": 30 },
  "C016": { "Breed": "Jersey", "Age": 5.5, "Sex": "F", "Weight": 415, "Vaccination": "Up-to-date", "MilkYield": 22 },
  "C017": { "Breed": "Sahiwal", "Age": 6.2, "Sex": "F", "Weight": 525, "Vaccination": "FMD (2025-03-20)", "MilkYield": 15 },
  "C018": { "Breed": "Gir", "Age": 5.7, "Sex": "F", "Weight": 455, "Vaccination": "Up-to-date", "MilkYield": 11 },
  "C019": { "Breed": "Holstein", "Age": 4.2, "Sex": "F", "Weight": 470, "Vaccination": "BQ Vaccine (2025-05-11)", "MilkYield": 29 },
  "C020": { "Breed": "Jersey", "Age": 3.8, "Sex": "F", "Weight": 435, "Vaccination": "Up-to-date", "MilkYield": 19 }
};

const cows_ta = {
  "C001": { "Breed": "ஹோல்ஸ்டீன்-பிரிசியன்", "Age": 4.4, "Sex": "பெண்", "Weight": 680, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 31 },
  "C002": { "Breed": "ஹோல்ஸ்டீன்-பிரிசியன்", "Age": 5.0, "Sex": "பெண்", "Weight": 710, "Vaccination": "FMD (2025-03-10)", "MilkYield": 29 },
  "C003": { "Breed": "ஜெர்சி", "Age": 2.6, "Sex": "பெண்", "Weight": 440, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 21 },
  "C004": { "Breed": "ஆங்கஸ்", "Age": 2.8, "Sex": "ஆண்", "Weight": 850, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 0 },
  "C005": { "Breed": "ஜெர்சி", "Age": 6.1, "Sex": "பெண்", "Weight": 465, "Vaccination": "BQ தடுப்பூசி (2025-05-01)", "MilkYield": 0 },
  "C006": { "Breed": "ஹெர்ஃபோர்ட்", "Age": 1.5, "Sex": "பெண்", "Weight": 520, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 0 },
  "C007": { "Breed": "கிர்", "Age": 4.0, "Sex": "பெண்", "Weight": 490, "Vaccination": "ஆன்திராக்ஸ் (2025-04-15)", "MilkYield": 13 },
  "C008": { "Breed": "ஆங்கஸ்", "Age": 3.3, "Sex": "ஆண்", "Weight": 910, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 0 },
  "C009": { "Breed": "ஹோல்ஸ்டீன்-பிரிசியன்", "Age": 2.2, "Sex": "பெண்", "Weight": 590, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 25 },
  "C010": { "Breed": "ஜெர்சி", "Age": 5.6, "Sex": "பெண்", "Weight": 455, "Vaccination": "FMD பூஸ்டர் (2025-03-12)", "MilkYield": 20 },
  "C011": { "Breed": "ஹோல்ஸ்டீன்", "Age": 4.5, "Sex": "பெண்", "Weight": 460, "Vaccination": "FMD பூஸ்டர் (2025-03-15)", "MilkYield": 28 },
  "C012": { "Breed": "ஜெர்சி", "Age": 5.1, "Sex": "பெண்", "Weight": 405, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 20 },
  "C013": { "Breed": "சாஹிவால்", "Age": 6.0, "Sex": "பெண்", "Weight": 510, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 14 },
  "C014": { "Breed": "கிர்", "Age": 4.8, "Sex": "பெண்", "Weight": 475, "Vaccination": "ஆன்திராக்ஸ் (2025-04-02)", "MilkYield": 12 },
  "C015": { "Breed": "ஹோல்ஸ்டீன்", "Age": 3.9, "Sex": "பெண்", "Weight": 490, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 30 },
  "C016": { "Breed": "ஜெர்சி", "Age": 5.5, "Sex": "பெண்", "Weight": 415, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 22 },
  "C017": { "Breed": "சாஹிவால்", "Age": 6.2, "Sex": "பெண்", "Weight": 525, "Vaccination": "FMD (2025-03-20)", "MilkYield": 15 },
  "C018": { "Breed": "கிர்", "Age": 5.7, "Sex": "பெண்", "Weight": 455, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 11 },
  "C019": { "Breed": "ஹோல்ஸ்டீன்", "Age": 4.2, "Sex": "பெண்", "Weight": 470, "Vaccination": "BQ தடுப்பூசி (2025-05-11)", "MilkYield": 29 },
  "C020": { "Breed": "ஜெர்சி", "Age": 3.8, "Sex": "பெண்", "Weight": 435, "Vaccination": "கால்நடை தடுப்பூசி முழுமை", "MilkYield": 19 }
};


const medicineRecommendations_en = [
  { healthIssue: "Calf Scours", drugName: "Sulfamethazine", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Twice daily for 4 days", withdrawal: "96 hours (4 days)" },
  { healthIssue: "Respiratory Disease", drugName: "Enrofloxacin", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Once daily for 3 days", withdrawal: "96 hours (4 days)" },
  { healthIssue: "Mastitis", drugName: "Amoxicillin", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Once daily for 5 days", withdrawal: "60 hours (2.5 days)" },
  { healthIssue: "Lameness", drugName: "Ketoprofen", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Single dose", withdrawal: "24 hours (1 day)" },
  { healthIssue: "Milk Fever", drugName: "Calcium Gluconate", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Single dose IV", withdrawal: "0 hours" },
  { healthIssue: "Bloat", drugName: "Poloxalene", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Single dose, repeat if needed", withdrawal: "0 hours" },
  { healthIssue: "Parasites (Internal)", drugName: "Albendazole", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Single oral dose", withdrawal: "120 hours (5 days)" },
  { healthIssue: "Parasites (External)", drugName: "Ivermectin", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Single injection (SC)", withdrawal: "Consult Vet (Varies)" },
  { healthIssue: "Black Quarter (BQ)", drugName: "Penicillin G", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "High dose, daily for 5-7 days", withdrawal: "72 hours (3 days)" },
  { healthIssue: "Ringworm (Fungus)", drugName: "Griseofulvin", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Oral, daily for 7 days", withdrawal: "Consult Vet (Varies)" },
  { healthIssue: "Foot & Mouth (FMD)", drugName: "Flunixin Meglumine", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Supportive care for fever/pain", withdrawal: "36 hours (1.5 days)" },
  { healthIssue: "Theileriosis", drugName: "Buparvaquone", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Two doses, 48-72 hrs apart", withdrawal: "48 hours (2 days)" },
  { healthIssue: "Anaplasmosis", drugName: "Oxytetracycline", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "Daily for 3-5 days", withdrawal: "96 hours (4 days)" },
  { healthIssue: "Anthrax", drugName: "Penicillin G", dosage: [{ min: 1, max: 6, amount: 1000 }, { min: 6, max: 24, amount: 1500 }, { min: 24, max: 60, amount: 2500 }, { min: 60, max: 600, amount: 3000 }], schedule: "High dose IV, aggressive Tx", withdrawal: "72 hours (3 days)" }
];
const medicineRecommendations_ta = [
  {
    healthIssue: "கால்ப் ஸ்கார்ஸ்",
    drugName: "சல்பாமெத்தைசின்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "நாளைக்கு இருமுறை 4 நாட்கள்",
    withdrawal: "96 மணி நேரம் (4 நாட்கள்)"
  },
  {
    healthIssue: "சுவாச நோய்",
    drugName: "என்ரோஃபுளாக்சாசின்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "நாளைக்கு ஒருமுறை 3 நாட்கள்",
    withdrawal: "96 மணி நேரம் (4 நாட்கள்)"
  },
  {
    healthIssue: "மாஸ்டிடிஸ்",
    drugName: "அமொக்சிசிலின்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "நாளைக்கு ஒருமுறை 5 நாட்கள்",
    withdrawal: "60 மணி நேரம் (2.5 நாட்கள்)"
  },
  {
    healthIssue: "நடுத்தெரியும் வலி",
    drugName: "கீடோப்ரோஃபென்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "ஒன்றே ஒரு மருந்து அளவு",
    withdrawal: "24 மணி நேரம் (1 நாள்)"
  },
  {
    healthIssue: "பால் காய்ச்சல்",
    drugName: "கல்சியம் கிளுகோனேட்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "ஒன்றே ஒரு மருந்து இன்ஜெக்சன்",
    withdrawal: "0 மணி நேரம்"
  },
  {
    healthIssue: "வெப்பம்",
    drugName: "பொலக்ஸலீன்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "ஒன்றே ஒரு மருந்து அளவு, தேவையானால் மீண்டும் கொடுக்கவும்",
    withdrawal: "0 மணி நேரம்"
  },
  {
    healthIssue: "உள் புழுக்கள்",
    drugName: "அல்பென்டசோல்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "ஒன்றே ஒரு வாய்வழி மருந்து அளவு",
    withdrawal: "120 மணி நேரம் (5 நாட்கள்)"
  },
  {
    healthIssue: "வெளி புழுக்கள்",
    drugName: "இவர்மெக்டின்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "ஒன்றே ஒரு இன்ஜெக்ஷன் (உட்பகுதி)",
    withdrawal: "வெட்டனரி மருத்துவரை அணுகவும் (மாறுபாடு)"
  },
  {
    healthIssue: "பிளாக் குவார்டர் (BQ)",
    drugName: "பெனிசிலின் ஜி",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "உயர் மட்டம், நாளுக்கு 5-7 நாட்கள்",
    withdrawal: "72 மணி நேரம் (3 நாட்கள்)"
  },
  {
    healthIssue: "சுற்று புற்று (பரு)",
    drugName: "கிரிசியோஃபுல்வின்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "வாய்வழி, நாளுக்கு 7 நாட்கள்",
    withdrawal: "வெட்டனரி மருத்துவரை அணுகவும் (மாறுபாடு)"
  },
  {
    healthIssue: "கால் மற்றும் வாய் நோய் (FMD)",
    drugName: "ஃபுளூனிக்சின் மெக்லுமின்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "ஊட்டச்சத்து மற்றும் வலிப்பாடுகள் சிகிச்சை",
    withdrawal: "36 மணி நேரம் (1.5 நாட்கள்)"
  },
  {
    healthIssue: "தெயிலெரியோசிஸ்",
    drugName: "புபார்வாக்வோன்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "இரு மருந்து அளவுகள், 48-72 மணி நேர இடைவெளி",
    withdrawal: "48 மணி நேரம் (2 நாட்கள்)"
  },
  {
    healthIssue: "அனபிளாஸ்மோசிஸ்",
    drugName: "ஓக்ஸிடெட்ராசைக்கிளின்",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "3-5 நாட்கள் நாடுக்கு ஒருமுறை",
    withdrawal: "96 மணி நேரம் (4 நாட்கள்)"
  },
  {
    healthIssue: "ஆன்ட்ராக்ஸ்",
    drugName: "பெனிசிலின் ஜி",
    dosage: [
      { min: 1, max: 6, amount: 1000 },
      { min: 6, max: 24, amount: 1500 },
      { min: 24, max: 60, amount: 2500 },
      { min: 60, max: 600, amount: 3000 }
    ],
    schedule: "உயர் மட்ட IV, தீவிர சிகிச்சை",
    withdrawal: "72 மணி நேரம் (3 நாட்கள்)"
  }
];


// Language setup
let language = localStorage.getItem('language') || 'en';
let cows = (language === 'ta') ? cows_ta : cows_en;
let medicineRecommendations = (language === 'ta') ? medicineRecommendations_ta : medicineRecommendations_en;

// Set all visible text based on language
function setUIText() {
  document.getElementById('navDashboard').innerText = dict[language].dashboard;
  document.getElementById('navCow').innerText = dict[language].cow;
  document.getElementById('navMedRec').innerText = dict[language].medRec;
  document.getElementById('navMRL').innerText = dict[language].mrl;
  document.getElementById('navAMU').innerText = dict[language].amuLogs;
  document.getElementById('logoutText').innerText = dict[language].logout;
  document.getElementById('dashboardTitle').innerText = dict[language].dashboardWelcome;
  document.getElementById('dashboardDesc').innerText = dict[language].dashboardDesc;
  document.getElementById('cowTitle').innerText = dict[language].cow;
  document.getElementById('cowPrompt').innerText = dict[language].cowPrompt;
  document.getElementById('cowIdLabel').innerText = dict[language].cowIdLabel;
  document.getElementById('cowShowBtn').innerText = dict[language].cowShowBtn;
  document.getElementById('medRecTitle').innerText = dict[language].medRec;
  document.getElementById('recBreed').placeholder = dict[language].medRecBreed;
  document.getElementById('recAge').placeholder = dict[language].medRecAge;
  document.getElementById('recDisease').placeholder = dict[language].medRecDisease;
  document.getElementById('recommendBtn').innerText = dict[language].medRecBtn;
  document.getElementById('manageMRL').innerText = dict[language].manageMRL;
  document.getElementById('chemTh').innerText = dict[language].chemTh;
  document.getElementById('speciesTh').innerText = dict[language].speciesTh;
  document.getElementById('maxResTh').innerText = dict[language].maxResTh;
  document.getElementById('addMRLBtn').innerText = dict[language].addMRLBtn;
  document.getElementById('mrl-search').placeholder = dict[language].searchMRLPlaceholder;
  document.getElementById('tagTh').innerText = dict[language].tagTh;
  document.getElementById('chemAMUTh').innerText = dict[language].chemAMUTh;
  document.getElementById('dateTh').innerText = dict[language].dateTh;
  document.getElementById('dosageTh').innerText = dict[language].dosageTh;
  document.getElementById('logAMU').innerText = dict[language].logAMU;
  document.getElementById('logAMUBtn').innerText = dict[language].logAMUBtn;
  document.getElementById('amu-search').placeholder = dict[language].searchAMUPlaceholder;
}
setUIText();

// Tab navigation logic
const tabs = [
  { nav: 'navDashboard', section: 'dashboard' },
  { nav: 'navCow', section: 'cow-section' },
  { nav: 'navMedRec', section: 'medrec-section' },
  { nav: 'navMRL', section: 'mrl-section' },
  { nav: 'navAMU', section: 'amu-section' }
];
tabs.forEach(({ nav, section }) => {
  document.getElementById(nav).addEventListener('click', (e) => {
    e.preventDefault();
    document.querySelectorAll('.tab-section').forEach(div => div.classList.remove('active-section'));
    document.getElementById(section).classList.add('active-section');
    tabs.forEach(tab => document.getElementById(tab.nav).classList.remove('active'));
    document.getElementById(nav).classList.add('active');
  });
});

// Cow Data Display
function showCowData() {
  const id = document.getElementById("cowId").value.trim();
  const resultDiv = document.getElementById("result");
  if (id === "") {
    resultDiv.innerHTML = `<p>${dict[language].cowIdLabel}</p>`;
    return;
  }
  const cow = cows[id];
  if (!cow) {
    resultDiv.innerHTML = `<p>No data found for Cow ID: <strong>${id}</strong></p>`;
    return;
  }
  resultDiv.innerHTML = `
    <table>
      <tr><th>Attribute</th><th>Value</th></tr>
      <tr><td>Cow ID</td><td>${id}</td></tr>
      <tr><td>${dict[language].medRecBreed}</td><td>${cow.Breed}</td></tr>
      <tr><td>${dict[language].medRecAge}</td><td>${cow.Age}</td></tr>
      <tr><td>Sex</td><td>${cow.Sex}</td></tr>
      <tr><td>Weight (kg)</td><td>${cow.Weight}</td></tr>
      <tr><td>Vaccination History</td><td>${cow.Vaccination}</td></tr>
      <tr><td>Milk Yield (L/day)</td><td>${cow.MilkYield}</td></tr>
    </table>
  `;
}

// Medicine Recommendation
document.getElementById("recommendBtn").onclick = function() {
  const breed = document.getElementById("recBreed").value.trim();
  const age = parseFloat(document.getElementById("recAge").value);
  const disease = document.getElementById("recDisease").value.trim();
  const resultDiv = document.getElementById("recommendResult");

  if (!breed || isNaN(age) || !disease) {
    resultDiv.innerHTML = `<p style="color:red;">Please fill all fields.</p>`;
    return;
  }
  const rec = medicineRecommendations.find(r =>
    r.healthIssue.toLowerCase() === disease.toLowerCase()
  );
  if (!rec) {
    resultDiv.innerHTML = `<p style="color:red;">No recommendation found for "${disease}".</p>`;
    return;
  }
  let dosageInfo = rec.dosage.find(d => age >= d.min && age < d.max) || rec.dosage[rec.dosage.length - 1];
  resultDiv.innerHTML = `
    <table>
      <tr><th>Drug Name</th><td>${rec.drugName}</td></tr>
      <tr><th>Recommended Dosage</th><td>${dosageInfo.amount} mg</td></tr>
      <tr><th>Schedule</th><td>${rec.schedule}</td></tr>
      <tr><th>Milk Withdrawal</th><td>${rec.withdrawal}</td></tr>
    </table>
  `;
};

// MRL Section
let mrlData = [];
function renderMRL(data) {
  const tbody = document.querySelector('#mrl-table tbody');
  tbody.innerHTML = data.map(row =>
    `<tr>
      <td>${row.chemical}</td>
      <td>${row.species || ""}</td>
      <td>${row.maxResidue || ""}</td>
      <td>${row.milkYield || ""}</td>
      <td style="color: ${row.milkYield === "No" ? "red" : "green"};">${row.warning || ""}</td>
    </tr>`
  ).join('');
}
document.getElementById('mrl-form').onsubmit = e => {
  e.preventDefault();
  const { chemical, species, maxResidue, cowId, dosageInput } = e.target.elements;
  const drug = chemical.value.trim();
  const cowID = cowId.value.trim();
  const enteredDosage = parseFloat(dosageInput.value);
  const age = cows[cowID] ? cows[cowID].Age : null;
  const recommendation = medicineRecommendations.find(r => r.drugName.toLowerCase() === drug.toLowerCase());
  let milkYieldStatus = "Unknown";
  let warningMsg = "";

  if (recommendation && age != null && !isNaN(enteredDosage)) {
    let dosageInfo = recommendation.dosage.find(d => age >= d.min && age < d.max) || recommendation.dosage[recommendation.dosage.length - 1];
    if (enteredDosage <= dosageInfo.amount) {
      milkYieldStatus = "Yes";
      warningMsg = (language === 'ta') ? "பாலினை எடுத்துக்கொள்ளலாம்." : "Milk yield is SAFE.";
    } else {
      milkYieldStatus = "No";
      warningMsg = (language === 'ta')
        ? "எச்சரிக்கை: வயதிற்கான வழிகாட்டி அளவை மீறுகிறது. பாலை எடுத்துக்கொள்ளக்கூடாது."
        : "WARNING: Dosage exceeds guideline for this age. Milk yield should NOT be collected.";
    }
  } else {
    warningMsg = (language === 'ta') ? "சரியான மருந்து, காளை ஐடி, அளவை உள்ளிடவும்." : "Please enter valid drug, cow ID, and dosage.";
  }

  mrlData.push({
    chemical: drug,
    species: species.value,
    maxResidue: maxResidue.value,
    cowId: cowID,
    dosage: enteredDosage,
    milkYield: milkYieldStatus,
    warning: warningMsg
  });
  e.target.reset();
  renderMRL(mrlData);
};
document.getElementById('mrl-search').addEventListener('input', e => {
  const searchTerm = e.target.value.toLowerCase();
  const filtered = mrlData.filter(row =>
    (row.chemical && row.chemical.toLowerCase().includes(searchTerm)) ||
    (row.species && row.species.toLowerCase().includes(searchTerm)) ||
    (row.maxResidue && row.maxResidue.toString().toLowerCase().includes(searchTerm)) ||
    (row.cowId && row.cowId.toLowerCase().includes(searchTerm)) ||
    (row.warning && row.warning.toLowerCase().includes(searchTerm))
  );
  renderMRL(filtered);
});

// AMU Section
let amuData = [];
function renderAMU(data) {
  const tbody = document.querySelector('#amu-table tbody');
  tbody.innerHTML = data.map(row =>
    `<tr>
      <td>${row.tagNo}</td>
      <td>${row.chemical}</td>
      <td>${row.date}</td>
      <td>${row.dosage}</td>
    </tr>`
  ).join('');
}
document.getElementById('amu-form').onsubmit = e => {
  e.preventDefault();
  const { tagNo, chemical, date, dosage } = e.target.elements;
  amuData.push({ tagNo: tagNo.value, chemical: chemical.value, date: date.value, dosage: dosage.value });
  e.target.reset();
  renderAMU(amuData);
};
document.getElementById('amu-search').addEventListener('input', e => {
  const searchTerm = e.target.value.toLowerCase();
  const filtered = amuData.filter(row =>
    (row.tagNo && row.tagNo.toLowerCase().includes(searchTerm)) ||
    (row.chemical && row.chemical.toLowerCase().includes(searchTerm)) ||
    (row.date && row.date.toLowerCase().includes(searchTerm)) ||
    (row.dosage && row.dosage.toLowerCase().includes(searchTerm))
  );
  renderAMU(filtered);
});

// Initial render
renderMRL(mrlData);
renderAMU(amuData);
</script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>